<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auctions App</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js" defer></script>
    <script src="main2.js" defer></script>
</head>
<body>
<div id="app">
    <h1>Auctions App</h1>

    <!-- Bottone Login/Signup -->
    <div v-if="!authenticated && !showLoginForm">
        <button @click="toggleLoginForm">Sign in / Sign up</button>
    </div>

    <!-- Sezione Login/Signup -->
    <div v-if="showLoginForm">
        <h2>Sign in</h2>
        <form @submit.prevent="signin">
            <label>Username: <input type="text" v-model="signinData.username" required/></label>
            <label>Password: <input type="password" v-model="signinData.password" required/></label>
            <button type="submit">Sign in</button>
        </form>

        <h2>Sign up</h2>
        <form @submit.prevent="signup">
            <label>Username: <input type="text" v-model="signupData.username" required/></label>
            <label>Name: <input type="text" v-model="signupData.name" required/></label>
            <label>Surname: <input type="text" v-model="signupData.surname" required/></label>
            <label>Password: <input type="password" v-model="signupData.password" required/></label>
            <button type="submit">Sign up</button>
        </form>
        <button @click="toggleLoginForm">Back</button>
    </div>

    <!-- Dashboard Utente -->
    <div v-if="authenticated">
        <h2>Welcome, {{ userInfo.username }}</h2>
        <button class="logout-button" @click="signout">Sign out</button>
        <button @click="toggleNewAuctionForm">New Auction</button>

        <!-- Creazione Nuova Asta -->
        <div v-if="showNewAuctionForm">
            <h2>Create a New Auction</h2>
            <form @submit.prevent="createAuction">
                <label>Title: <input type="text" v-model="newAuction.title" required/></label>
                <label>Description: <input type="text" v-model="newAuction.description" required></input></label>
                <label>Starting price: <input type="number" v-model="newAuction.startPrice" required></input></label>
                <label>End Time: <input type="datetime-local" v-model="newAuction.endTime" required></input></label>
                <button type="submit">Create</button>
            </form>
        </div>
    </div>

    <!-- Elenco Aste -->
    <div v-if="!showLoginForm">
        <h2>Auctions</h2>
        <!-- <button @click="fetchAuctions">Fetch auctions</button> -->
        <form @submit.prevent="fetchAuctions">
            <label>
                <input type="text" v-model="auctionsQuery" placeholder="Search in auctions..."/>
            </label>
            <button type="submit">Search auctions</button>
        </form>
        <ul>
            <li v-for="auction in auctions" :key="auction.id">
                <strong>{{ auction.title }}</strong><br>
                {{ auction.description }} <br>
                Current Price: {{ auction.currentPrice }} € <br>
                Auction ends on: {{ formatDate(auction.endTime) }} <br>
                <!-- Status: {{ auction.status }} <br> sarà calcolato -->
            </li>
        </ul>
    </div>

    <div v-if="!showLoginForm">
        <h2>Users</h2>
        <form @submit.prevent="fetchUsers">
            <label>
                <input type="text" v-model="usersQuery" placeholder="Search users..."/>
            </label>
            <button type="submit">Search users</button>
        </form>
        <!--        <button @click="fetchUsers">Search users</button>-->
        <ul>
            <li v-for="user in users" :key="user.id">
                <strong>{{ user.username }}</strong><br>
                Name: {{ user.name }} {{ user.surname }} <br>
            </li>
        </ul>
    </div>


</div>
</body>
</html>
